@model IEnumerable<Agric.Models.Essai>
@using System.Globalization;
@{ ViewBag.Title = "EssaiSemaine";
Layout = "~/Views/Shared/_AdminLayout.cshtml"; }


<div class="text-center"><h2>ESSAIS </h2></div>
&nbsp;&nbsp;&nbsp;&nbsp;


<div class="container-fluid" style="width: auto; overflow: auto; scrollbar-base-color: #ffeaff">
<table class="table table-hover " id="example">
<thead class="bg-primary text-light">
<tr>
<th style="min-width:130px ; text-align:center">
<p> Date de Notation</p>
</th>
<th style="min-width:130px ; text-align:center">
Nom de Client
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Code)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Produit)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.MA)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Culture)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Cible)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Region)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.PR)
</th>

<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.Date_Cloture)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.TechName)
</th>
<th style="min-width:130px ; text-align:center">
@Html.DisplayNameFor(model => model.RapportRemis)
</th>

</tr>
</thead>
<tbody>

@foreach (var item in Model)
{
if (item.Date_Cloture == null)
{
    <tr style="background-color: white" onclick="location.href = '@(Url.Action("DetailsEssai", new { id = item.Id })) '">

        @{ 
            var maDate = item.Notation.Select(d => d.D_N_P).Where(d =>  CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(d, CalendarWeekRule.FirstFullWeek, DayOfWeek.Monday) == CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(DateTime.Now, CalendarWeekRule.FirstFullWeek, DayOfWeek.Monday));
            


        <td style="text-align:center">
        @foreach (var date in maDate)
        {

            string nomJour = date.ToString("dd/MM/yyyy");
        @nomJour <br /> }
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Users.Fullname)
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Code)
        </td>

        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Produit)
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.MA)
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Culture)
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Cible)
        </td>

        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.Region)
        </td>
        <td style="  text-align:center">
            @Html.DisplayFor(modelItem => item.PR)
        </td>


        <td style="  text-align:center ; color:yellow">
            @Html.DisplayFor(modelItem => item.Date_Cloture)
        </td>
        <td style="  text-align:center ">
            @Html.DisplayFor(modelItem => item.TechName)
        </td>
        <td style="  text-align:center">
            @{ if (item.RapportRemis == true)
                {
    <p>
        <i class="fa fa-window-close fa-circle" style="color:green" aria-hidden="true"></i>
    </p> }
                else if (item.RapportRemis == false)
                {
    <p>
        <i class="fa fa-window-close fa-circle" style="color:red" aria-hidden="true"></i>
    </p> }
                else
                {<p>
        <i class="fa fa-window-close fa-circle" style="color:red" aria-hidden="true"></i>
    </p> } }
        </td>
                    }
                


    </tr>
}
}
</tbody>

</table>
</div>






<!-- Page level custom scripts -->

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>


<script>
$(document).ready(function () {
var table = $('#example').DataTable({
buttons: ['excel',],
"oLanguage": {
"sSearch": "Recherche"
},
bInfo: false,
Paginate: true,
scrollX: true,
lengthChange: false
});

table.buttons().container()
.appendTo('#example_wrapper .col-md-6:eq(0)');
});
</script>

<style>
.dataTables_scrollBody {
overflow-x: visible !important;
overflow-y: auto !important;
}

.dataTables_filter {
white-space: nowrap;
}

.dataTables_filter label, .dataTables_filter input {
display: inline-block;
color: dimgrey;
}

.buttons-excel {
background-color: green;
color: white;
}

</style>
