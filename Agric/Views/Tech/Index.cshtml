@model  IEnumerable<Agric.Models.Essai>
@using System.Globalization;
@{ ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_TechLayout.cshtml"; }


<div class="text-center"><h2>ESSAIS A TRAITER </h2></div>
&nbsp;&nbsp;&nbsp;&nbsp;

<div class="d-xl-flex align-items-center text-md-center">


    <a class="nav-link" href="/Tech/DownloadCD">
        <i class="fas fa-fw fa-table"></i>
        <span>Calculer une dose </span>
    </a>

    <a class="nav-link" href="/Tech/EssaiSemaine">
        <i class="fas fa-fw fa-table"></i>
        <span>Essais de cette semaine</span>
    </a>
    <form action="~/Tech/Datepicker" method="get" class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
        <div class="input-group">
            <input type="date" name="search" class="form-control bg-light border-0 small" style=" min-width:200px;" placeholder="Search for..."
                   aria-label="search" aria-describedby="basic-addon2">
            <div class="input-group-append">
                <button class="btn " type="submit" value="Search" style="background-color: #779523; color: white">
                    <i class="fas fa-search fa-sm"></i>
                </button>

            </div>
        </div>
    </form>
</div>
<script>
    $(document).ready(function () {
        $(".datepicker").datepicker({
            dateFormat: "dd-mm-yy",
            changemonth: true,
            changeyear: true
        });
    });
</script>

<script>
    function myFunction() {
        confirm("Press a button!");
    }
</script>
<hr />
<style>
    div.scrollmenu {
        background-color: #333;
        overflow: auto;
        white-space: nowrap;
    }

        div.scrollmenu a {
            display: inline-block;
            color: white;
            text-align: center;
            padding: 14px;
            text-decoration: none;
        }

            div.scrollmenu a:hover {
                background-color: #777;
            }
</style>
<div class="container-fluid" style=" overflow:auto">


    <table class="table table-hover " id="example">
        <thead class="bg-primary text-light">
            <tr>
                <th style="min-width:130px ; text-align:center">
                    <p> Cette Semaine</p>
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.CodeClient)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Code)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Region)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Culture)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Cible)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Produit)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.DP)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Formulation)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.PR)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.DPRéf)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.FormulationProduitRéf)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.TA)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.PE)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Date_Instalation)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.FDEFicheEssai)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.Date_Cloture)
                </th>
                <th style="min-width:130px ; text-align:center">
                    @Html.DisplayNameFor(model => model.EtatPaiment)
                </th>
                <th style="min-width:130px ; text-align:center">
                    <p>Actions</p>
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                if (item.Date_Cloture == null)
                {

            <tr>
               
                 @{ var s = item.Notation.Where(e => e.Essai_Id == item.Id && e.D_N_P != null && e.D_N_R == null && e.FNotation == null && CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(e.D_N_P, CalendarWeekRule.FirstFullWeek, DayOfWeek.Monday) == CultureInfo.CurrentCulture.Calendar.GetWeekOfYear(DateTime.Now, CalendarWeekRule.FirstFullWeek, DayOfWeek.Monday)).Count();
                if (s != 0)
                {
        <td style="  text-align:center">
            <i class="fa fa-check-circle" style="color:red" aria-hidden="true"></i>
        </td>
         }
        else
        {
        <td>
        </td>
         } }
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.CodeClient)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Code)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Region)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Culture)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Cible)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Produit)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.DP)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Formulation)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.PR)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.DPRéf)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.FormulationProduitRéf)
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.TA)
                </td>
                <td style="  text-align:center">
                    @if (item.PE != null)
                    {

            @Html.ActionLink("Télécharger", "DownloadPE", new
            {
                Id = item.Id
            });
        }
                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Date_Instalation)
                </td>
                <td style="  text-align:center">
                    @if (item.FDEFicheEssai != null)
                    {
            @Html.ActionLink("Télécharger", "DownloadFDEFicheEssai", new { Id = item.Id })}

                </td>
                <td style="  text-align:center">
                    @Html.DisplayFor(modelItem => item.Date_Cloture)
                </td>

                <td style="  text-align:center">

                    <h6 class="text-muted f-w-400">
                        @{ if (item.EtatPaiment == true)
                            {
            <p>
                <i class="fa fa-window-close fa-circle" style="color:green" aria-hidden="true"></i>
            </p> }
        else if (item.EtatPaiment == false)
        {
            <p>
                <i class="fa fa-window-close fa-circle" style="color:red" aria-hidden="true"></i>
            </p> }
        else
        {
            <p>
                <i class="fa fa-window-close fa-circle" style="color:red" aria-hidden="true"></i>
            </p> } }
                    </h6>

                </td>
                <td>
                    <div class="row">
                        <div class="col-12 ">
                            @Html.ActionLink("Ajouter", "Edit", new { id = item.Id }, new { @class = "btn btn-success btn-sm btn-block m-1" })
                            @Html.ActionLink("Notations", "Notations", new { essai_id = item.Id }, new { @class = "btn btn-primary btn-sm btn-block m-1" })

                        </div>
                    </div>
                </td>
            </tr>
}
}

        </tbody>
    </table>

</div>



<!-- Page level custom scripts -->

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>


<script>
    $(document).ready(function () {
        var table = $('#example').DataTable({
            lengthChange: false,
            scrollX: true,
            "oLanguage": {
                "sSearch": "Recherche"
            },
            buttons: ['excel', 'copy'],
            fixedColumns: {
                leftColumns: 2
            },
            columnDefs: [{
                orderable: false,
                className: 'select-checkbox',
                blurable: true,
                targets: 0
            }],
            select: {
                style: 'os',
                selector: 'td:first-child'
            },
            order: [[1, 'asc']]
        });

        table.buttons().container()
            .appendTo('#example_wrapper .col-md-6:eq(0)');
    });
</script>

<style>
    .dataTables_filter {
        white-space: nowrap;
    }

        .dataTables_filter label, .dataTables_filter input {
            display: inline-block;
            color: dimgrey;
        }

    .buttons-excel {
        background-color: green;
        color: white;
    }

    .buttons-copy {
        background-color: blue;
        color: white;
    }
</style>
